<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô MR.2/1</title>

<style>
/* ===== 1. ORIGINAL RED THEME (Clean & Comfortable) ===== */
body{
    margin:0;
    padding:20px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
    transition: background .25s, color .25s;
    padding-bottom: 80px; /* ‡πÄ‡∏ß‡πâ‡∏ô‡∏ó‡∏µ‡πà‡πÉ‡∏´‡πâ AI ‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á */
}

:root{
    --bg:#ffffff;
    --text:#000;
    --sub:#555;
    --card:#f4f4f4;
    --btn:#ff3b30; /* ‡∏™‡∏µ‡πÅ‡∏î‡∏á‡πÄ‡∏î‡∏¥‡∏° */
    --btn-hover:#d63229;
    --border:#ddd;
    --warn:#ffcc00;
    --warn-active:#ff9500;
    --ai-bg:#e8f0fe; /* ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á AI ‡∏™‡∏µ‡∏ü‡πâ‡∏≤‡∏≠‡πà‡∏≠‡∏ô‡∏™‡∏ö‡∏≤‡∏¢‡∏ï‡∏≤ */
    --ai-text:#1a73e8;
}

.dark{
    --bg:#000;
    --text:#fff;
    --sub:#aaa;
    --card:#1c1c1e;
    --btn:#ff453a;
    --btn-hover:#ff6961;
    --border:#333;
    --warn:#ffd60a;
    --warn-active:#ff9f0a;
    --ai-bg:#1c1c1e;
    --ai-text:#64d2ff;
}

body{ background:var(--bg); color:var(--text); }

/* ===== TYPOGRAPHY ===== */
h2{
    text-align:center;
    margin:10px 0 5px;
    color:var(--btn);
    font-weight:700;
}

#time{
    text-align:center;
    color:var(--sub);
    font-size:14px;
    margin-bottom:15px;
}

#modeToggle{
    position:absolute;
    top:12px;
    right:12px;
    padding:8px 12px;
    font-size:18px;
    background:transparent;
    color:var(--text);
    border:none;
    cursor: pointer;
}

/* ===== BUTTONS (Original Style) ===== */
button.main-btn{
    width:100%;
    padding:15px;
    margin:8px 0;
    font-size:16px;
    font-weight:600;
    border:none;
    border-radius:12px;
    background:var(--btn);
    color:#fff;
    transition:.2s;
    box-shadow: 0 2px 5px rgba(0,0,0,0.15);
    cursor: pointer;
}
button.main-btn:active{ transform:scale(0.98); opacity:.9; }

/* ‡∏õ‡∏∏‡πà‡∏°‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ (Style ‡πÄ‡∏î‡∏¥‡∏°) */
button.reduce-btn{
    background: var(--card);
    color: var(--text);
    border: 2px solid var(--border);
    box-shadow: none;
}
button.reduce-btn.active{
    background: var(--warn-active);
    color: #000;
    border-color: var(--warn-active);
    animation: pulse 2s infinite;
    font-weight: bold;
}
@keyframes pulse { 
    0% { box-shadow: 0 0 0 0 rgba(255, 149, 0, 0.4); }
    70% { box-shadow: 0 0 0 10px rgba(255, 149, 0, 0); }
    100% { box-shadow: 0 0 0 0 rgba(255, 149, 0, 0); }
}

/* ‡∏õ‡∏∏‡πà‡∏°‡∏û‡∏¥‡πÄ‡∏®‡∏©‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö AI Tutor (‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÜ) */
button.tutor-btn {
    background: var(--ai-bg);
    color: var(--ai-text);
    border: 1px solid var(--ai-text);
    font-size: 14px;
    padding: 10px;
    display: none; /* ‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ‡∏Å‡πà‡∏≠‡∏ô */
}

/* ===== RESULT BOX ===== */
#resultBox{
    margin-top:20px;
    padding:20px;
    border-radius:16px;
    background:var(--card);
    border:1px solid var(--border);
    font-size:16px;
    line-height:1.6;
    min-height: 100px;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
}

/* ===== TABLE LAYOUT ===== */
.schedule-container { width: 100%; text-align: left; }
.schedule-row { display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border); padding: 12px 0; }
.schedule-row:last-child { border-bottom: none; }
.time-col { width: 35%; font-weight: bold; color: var(--btn); font-size: 15px; display: flex; flex-direction: column; }
.time-col span { font-size: 12px; color: var(--sub); font-weight: normal; }
.info-col { width: 65%; padding-left: 10px; }
.subject-name { font-weight: 600; display: block; line-height: 1.3; }
.room-name { font-size: 13px; color: var(--sub); margin-top: 4px; display: inline-block; background: var(--bg); padding: 2px 6px; border-radius: 4px; border: 1px solid var(--border); }

/* ===== AI SECTION (Clean Note Style) ===== */
.ai-section { 
    border-top: 1px solid var(--border); 
    padding-top: 20px; 
    margin-top: 30px; 
}
.ai-title { font-size: 1.1em; font-weight: bold; margin-bottom: 10px; color: var(--sub); display: flex; align-items: center; gap: 8px;}

textarea { 
    width: 100%; height: 80px; padding: 12px; 
    border-radius: 12px; border: 1px solid var(--border); 
    background: var(--card); color: var(--text); 
    font-family: inherit; resize: none; box-sizing: border-box; font-size: 14px; 
}
textarea:focus { outline: 2px solid var(--btn); border-color: transparent; }

.ai-controls { display: flex; gap: 10px; margin-top: 10px; }
.btn-ai { background: var(--sub); color: #fff; flex: 3; }
.btn-clear { background: var(--card); color: var(--sub); border: 1px solid var(--border); flex: 1; box-shadow: none; }

.ai-output { 
    margin-top: 15px; 
    background: var(--card); 
    padding: 15px; 
    border-radius: 12px; 
    border-left: 4px solid var(--btn); 
    font-size: 14px; 
    line-height: 1.6; 
    white-space: pre-wrap; 
    text-align: left;
    display: none;
}
.ai-output strong { color: var(--btn); }
</style>
</head>

<body>

<button id="modeToggle" onclick="toggleMode()">üåó</button>

<h2>‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô MR.2/1</h2>
<div id="time">Loading...</div>

<button id="btnReduce" class="main-btn reduce-btn" onclick="toggleReduce()">‚ö†Ô∏è ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏õ‡∏¥‡∏î)</button>

<button class="main-btn" onclick="currentClass()">üìå ‡∏Ñ‡∏≤‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏∞‡πÑ‡∏£</button>
<button class="main-btn" onclick="nextClass()">‚û°Ô∏è ‡∏Ñ‡∏≤‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ</button>
<button class="main-btn" onclick="breakTime()">‚è≥ ‡∏≠‡∏µ‡∏Å‡∏Å‡∏µ‡πà‡∏ô‡∏≤‡∏ó‡∏µ‡πÄ‡∏•‡∏¥‡∏Å/‡∏û‡∏±‡∏Å</button>
<button class="main-btn" onclick="showSchedule()">üìã ‡∏î‡∏π‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</button>

<div id="resultBox">‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</div>

<div class="ai-section">
    <div class="ai-title">üìù Hunter Note & Helper</div>
    <button id="btnTutor" class="main-btn tutor-btn" onclick="tutorCurrentClass()" style="margin-bottom:10px;">üéì ‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢</button>
    
    <textarea id="taskInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡πÇ‡∏ô‡πâ‡∏ï ‡∏´‡∏£‡∏∑‡∏≠‡∏™‡∏±‡πà‡∏á‡∏á‡∏≤‡∏ô... (‡πÄ‡∏ä‡πà‡∏ô '‡∏Å‡∏≤‡∏£‡∏ö‡πâ‡∏≤‡∏ô‡∏ß‡∏¥‡∏ä‡∏≤‡∏ô‡∏µ‡πâ‡∏™‡πà‡∏á‡∏ß‡∏±‡∏ô‡πÑ‡∏´‡∏ô', '‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡∏á‡∏≤‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°')"></textarea>
    
    <div class="ai-controls">
        <button class="main-btn btn-ai" onclick="askAI()">‚ú® ‡πÉ‡∏´‡πâ AI ‡∏ä‡πà‡∏ß‡∏¢‡∏Ñ‡∏¥‡∏î</button>
        <button class="main-btn btn-clear" onclick="clearNote()">‡∏•‡∏ö</button>
    </div>
    <div id="aiOutput" class="ai-output"></div>
</div>

<script>
/* ===== 1. SYSTEM & MEMORY ===== */
function toggleMode(){
    document.body.classList.toggle("dark");
    localStorage.setItem("theme",document.body.classList.contains("dark")?"dark":"light");
}
window.onload = () => {
    if(localStorage.getItem("theme")==="dark") document.body.classList.add("dark");
    if(localStorage.getItem("isReducedMode") === "true") {
        isReducedMode = true;
        updateReduceBtn();
    }
    // ‡πÇ‡∏´‡∏•‡∏î‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î
    const mem = localStorage.getItem("hunterMem");
    if(mem){ 
        document.getElementById("aiOutput").style.display="block";
        document.getElementById("aiOutput").innerHTML = mem;
    }
}

function thaiTime(){
    const d=new Date();
    const days=["‡∏≠‡∏≤‡∏ó‡∏¥‡∏ï‡∏¢‡πå","‡∏à‡∏±‡∏ô‡∏ó‡∏£‡πå","‡∏≠‡∏±‡∏á‡∏Ñ‡∏≤‡∏£","‡∏û‡∏∏‡∏ò","‡∏û‡∏§‡∏´‡∏±‡∏™","‡∏®‡∏∏‡∏Å‡∏£‡πå","‡πÄ‡∏™‡∏≤‡∏£‡πå"];
    return `${days[d.getDay()]} ${d.getDate()}/${d.getMonth()+1}/${d.getFullYear()+543} - ${d.toLocaleTimeString("th-TH")}`;
}
setInterval(()=>document.getElementById("time").innerText = thaiTime(),1000);

/* ===== 2. DATA (CORRECTED FROM IMAGE) ===== */
const scheduleData={
    2: [
        {start:"08:40", end:"10:20", name:"‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Ø (EDL)", room:"1051 (‡∏≠.REYNALYN)"},
        {start:"12:50", end:"14:30", name:"‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Ø (EDL)", room:"1053 (‡∏≠.SOPHIE)"}, /* ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å 13.40 ‡πÄ‡∏õ‡πá‡∏ô 14.30 */
        {start:"14:30", end:"15:20", name:"‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢‡∏Ø", room:"1221 (‡∏≠.‡∏ô‡∏û‡∏£‡∏±‡∏ï‡∏ô‡πå)"}
    ],
    3: [
        {start:"08:40", end:"12:00", name:"‡∏ï‡∏¥‡∏î‡∏ï‡∏±‡πâ‡∏á/‡∏Ñ‡∏ß‡∏ö‡∏Ñ‡∏∏‡∏°‡∏°‡∏≠‡πÄ‡∏ï‡∏≠‡∏£‡πå", room:"642 (TA.Suradet/O.Piya)"},
        {start:"12:50", end:"13:40", name:"‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏≠‡∏á‡∏Ñ‡πå‡∏Å‡∏≤‡∏£‡∏Ø", room:"432 (‡∏≠.‡∏†‡∏≤‡∏ì‡∏∏‡∏ß‡∏±‡∏í‡∏ô‡πå)"},
        {start:"14:30", end:"16:10", name:"‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Ø (EDL)", room:"1051 (‡∏≠.REYNALYN)"} /* ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å 15.20 ‡πÄ‡∏õ‡πá‡∏ô 16.10 */
    ],
    4: [
        {start:"08:40", end:"10:20", name:"‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏®‡∏≤‡∏™‡∏ï‡∏£‡πå‡πÑ‡∏ó‡∏¢", room:"1221 (‡∏≠.‡∏õ‡∏ì‡∏ì‡∏£‡∏±‡∏Å‡∏©‡πå)"}, /* ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å 09.30 ‡πÄ‡∏õ‡πá‡∏ô 10.20 */
        {start:"12:50", end:"16:10", name:"‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏≠‡∏∏‡∏ï‡∏™‡∏≤‡∏´‡∏Å‡∏£‡∏£‡∏°‡∏Ø", room:"424 (TA.Amarin/O.Prakit)"}
    ],
    5: [
        {start:"08:40", end:"12:00", name:"‡∏ä‡∏¥‡πâ‡∏ô‡∏™‡πà‡∏ß‡∏ô‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏Å‡∏•‡∏Ø", room:"544 (TA.Jiranan/O.Rattanasiri)"},
        {start:"14:30", end:"16:10", name:"‡∏†‡∏≤‡∏©‡∏≤‡∏≠‡∏±‡∏á‡∏Å‡∏§‡∏©‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏á‡∏≤‡∏ô‡∏ä‡πà‡∏≤‡∏á‡∏Ø (EDL)", room:"1051 (‡∏≠.SOPHIE)"} /* ‡πÅ‡∏Å‡πâ‡πÄ‡∏£‡∏¥‡πà‡∏° 14.30 */
    ],
    6: [
        {start:"08:40", end:"10:20", name:"‡∏Å‡∏≤‡∏£‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏¢‡∏±‡πà‡∏á‡∏¢‡∏∑‡∏ô", room:"223 (‡∏≠.‡∏®‡∏¥‡∏£‡∏¥‡∏ß‡∏£‡∏£‡∏ì)"}, /* ‡πÅ‡∏Å‡πâ‡∏à‡∏≤‡∏Å 09.30 ‡πÄ‡∏õ‡πá‡∏ô 10.20 */
        {start:"12:50", end:"16:10", name:"‡∏£‡∏∞‡∏ö‡∏ö‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏à‡∏±‡∏Å‡∏£‡∏Å‡∏•‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥", room:"1323 (IOT)"}
    ]
};

const timeMap = { "08:40":"08:40", "09:30":"09:20", "10:20":"10:00", "11:10":"10:40", "12:00":"11:20", "12:50":"12:00", "13:40":"12:40", "14:30":"13:20", "15:20":"14:00", "16:10":"14:40" };

let isReducedMode = false;
let currentSubjectName = "";

function toggleReduce() {
    isReducedMode = !isReducedMode;
    localStorage.setItem("isReducedMode", isReducedMode);
    updateReduceBtn();
}

function updateReduceBtn() {
    const btn = document.getElementById("btnReduce");
    if(isReducedMode) {
        btn.innerHTML = "‚ö° ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏≠‡∏¢‡∏π‡πà)";
        btn.classList.add("active");
        show("‡πÄ‡∏õ‡∏¥‡∏î‡πÇ‡∏´‡∏°‡∏î‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤ 40 ‡∏ô‡∏≤‡∏ó‡∏µ‡πÅ‡∏•‡πâ‡∏ß! \n‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏õ‡∏£‡∏±‡∏ö‡∏•‡∏î‡∏•‡∏á");
    } else {
        btn.innerHTML = "‚ö†Ô∏è ‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏õ‡∏¥‡∏î)";
        btn.classList.remove("active");
        show("‡∏Å‡∏•‡∏±‡∏ö‡∏™‡∏π‡πà‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏õ‡∏Å‡∏ï‡∏¥ (50 ‡∏ô‡∏≤‡∏ó‡∏µ)");
    }
}

function getSchedule(d) { 
    if(!scheduleData[d]) return null;
    if(!isReducedMode) return scheduleData[d];
    return scheduleData[d].map(i => ({...i, start:timeMap[i.start]||i.start, end:timeMap[i.end]||i.end}));
}

/* ===== 3. LOGIC ===== */
function toMin(t){let[h,m]=t.split(":");return +h*60+ +m;}
function nowMin(){let d=new Date();return d.getHours()*60+d.getMinutes();}
let timer=null;

function countdown(targetMin,text){
    clearInterval(timer);
    const update = () => {
        let now=nowMin();
        let diff=targetMin-now;
        if(diff<=0){
            clearInterval(timer);
            document.getElementById("resultBox").innerText = "‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤ / ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏Ñ‡∏≤‡∏ö‡πÅ‡∏•‡πâ‡∏ß";
            return;
        }
        let h=Math.floor(diff/60), m=diff%60;
        document.getElementById("resultBox").innerHTML = 
            `<strong>${text}</strong><br><br><span style="color:var(--btn); font-size:1.2em; font-weight:bold;">‚è≥ ‡πÄ‡∏´‡∏•‡∏∑‡∏≠ ${h > 0 ? h + ' ‡∏ä‡∏°. ' : ''}${m} ‡∏ô‡∏≤‡∏ó‡∏µ</span>`;
    };
    update();
    timer=setInterval(update,1000);
}

function currentClass(){
    const d=new Date().getDay(), n=nowMin();
    const sch = getSchedule(d);
    document.getElementById("btnTutor").style.display = "none";
    
    if(!sch) return show("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");

    for(const c of sch){
        if(n>=toMin(c.start) && n<toMin(c.end)){
            currentSubjectName = c.name; 
            document.getElementById("btnTutor").style.display = "block";
            countdown(toMin(c.end), `üìå ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (${isReducedMode?'‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤':'‡∏õ‡∏Å‡∏ï‡∏¥'}):<br>${c.name}<br>‡∏´‡πâ‡∏≠‡∏á ${c.room}`);
            return;
        }
    }
    show("‚è≥ ‡∏ï‡∏≠‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≤‡∏ö‡∏ß‡πà‡∏≤‡∏á / ‡∏û‡∏±‡∏Å");
}

function nextClass(){
    const d=new Date().getDay(), n=nowMin();
    const sch = getSchedule(d);
    if(!sch) return show("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
    for(const c of sch){
        if(toMin(c.start)>n){
            countdown(toMin(c.start), `‚û°Ô∏è ‡∏Ñ‡∏≤‡∏ö‡∏ï‡πà‡∏≠‡πÑ‡∏õ (${isReducedMode?'‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤':'‡∏õ‡∏Å‡∏ï‡∏¥'}):<br>${c.name}<br>‡∏´‡πâ‡∏≠‡∏á ${c.room}`);
            return;
        }
    }
    show("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Ñ‡∏£‡∏ö‡∏ó‡∏∏‡∏Å‡∏ß‡∏¥‡∏ä‡∏≤‡πÅ‡∏•‡πâ‡∏ß");
}

function breakTime(){
    const d=new Date().getDay(), n=nowMin();
    const sch = getSchedule(d);
    if(!sch) return show("‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô");
    for(const c of sch){
        if(n>=toMin(c.start) && n<toMin(c.end)){
            countdown(toMin(c.end), `üìö ‡πÄ‡∏•‡∏¥‡∏Å‡∏Ñ‡∏≤‡∏ö‡∏ô‡∏µ‡πâ (${c.name})`);
            return;
        }
    }
    for(const c of sch){
        if(toMin(c.start)>n){
            countdown(toMin(c.start), `‚òï ‡∏´‡∏°‡∏î‡πÄ‡∏ß‡∏•‡∏≤‡∏û‡∏±‡∏Å (‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏£‡∏µ‡∏¢‡∏ô)`);
            return;
        }
    }
    show("‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÅ‡∏•‡πâ‡∏ß ‡∏Å‡∏•‡∏±‡∏ö‡∏ö‡πâ‡∏≤‡∏ô‡πÑ‡∏î‡πâ! üè†");
}

function showSchedule(){
    clearInterval(timer);
    let d = new Date().getDay();
    let n = nowMin();
    let title = "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ";
    
    // Logic: ‡∏î‡∏π‡∏ß‡∏±‡∏ô‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏ñ‡πâ‡∏≤‡πÄ‡∏¢‡πá‡∏ô‡πÅ‡∏•‡πâ‡∏ß
    if(n > 990 || !scheduleData[d]) {
         for(let i=1; i<=7; i++) {
             let nd = (d+i)%7;
             if(scheduleData[nd]) { d = nd; title = "‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ß‡∏±‡∏ô‡∏ñ‡∏±‡∏î‡πÑ‡∏õ"; break; }
         }
    }
    const sch = getSchedule(d);
    if(!sch) return show("‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡πÄ‡∏£‡πá‡∏ß‡πÜ ‡∏ô‡∏µ‡πâ");
    
    let html = `<div style="width:100%;"><h3 style="margin:0 0 15px; color:var(--text);">${title} ${isReducedMode?'(‡∏•‡∏î‡πÄ‡∏ß‡∏•‡∏≤) ‚ö°':''}</h3><div class="schedule-container">`;
    sch.forEach(c=>{
        html += `<div class="schedule-row"><div class="time-col">${c.start}<span>‡∏ñ‡∏∂‡∏á ${c.end}</span></div><div class="info-col"><span class="subject-name">${c.name}</span><span class="room-name">‡∏´‡πâ‡∏≠‡∏á ${c.room}</span></div></div>`;
    });
    html += `</div></div>`;
    document.getElementById("resultBox").innerHTML = html;
}

function show(t){
    clearInterval(timer);
    document.getElementById("resultBox").innerText = t;
}

/* ===== 4. AI LOGIC (SUPER PLANNER UPGRADE) ===== */
const API_KEY = "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"; 
const MODEL = "llama-3.3-70b-versatile";

function clearNote(){
    localStorage.removeItem("hunterMem");
    document.getElementById("aiOutput").style.display="none";
    document.getElementById("aiOutput").innerHTML="";
    document.getElementById("taskInput").value="";
}

function tutorCurrentClass() {
    if(!currentSubjectName) return;
    document.getElementById("taskInput").value = `‡∏™‡∏£‡∏∏‡∏õ‡πÄ‡∏ô‡∏∑‡πâ‡∏≠‡∏´‡∏≤‡∏ß‡∏¥‡∏ä‡∏≤ "${currentSubjectName}" ‡πÉ‡∏´‡πâ‡∏´‡∏ô‡πà‡∏≠‡∏¢‡∏Ñ‡∏£‡∏±‡∏ö ‡πÄ‡∏ô‡πâ‡∏ô‡∏´‡∏±‡∏ß‡∏Ç‡πâ‡∏≠‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç`;
    askAI();
}

async function askAI() {
    const input = document.getElementById("taskInput").value.trim();
    if (!input) return;

    const out = document.getElementById("aiOutput");
    const btn = document.querySelector(".btn-ai");
    
    // 1. Loading State
    out.style.display = "block";
    out.innerHTML = "üß† Hunter ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ß‡∏≤‡∏á‡πÅ‡∏ú‡∏ô‡πÅ‡∏•‡∏∞‡∏õ‡∏£‡∏∞‡∏°‡∏ß‡∏•‡∏ú‡∏•...";
    const oldBtnText = btn.innerText;
    btn.innerText = "‚è≥ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏¥‡∏î...";
    btn.disabled = true;

    // 2. Build Context (‡∏£‡∏π‡πâ‡πÄ‡∏Ç‡∏≤‡∏£‡∏π‡πâ‡πÄ‡∏£‡∏≤)
    const d = new Date().getDay();
    const sch = getSchedule(d);
    const n = nowMin();
    
    // ‡∏´‡∏≤‡∏ö‡∏£‡∏¥‡∏ö‡∏ó‡πÄ‡∏ß‡∏•‡∏≤: ‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏≠‡∏¢‡∏π‡πà? ‡∏ß‡πà‡∏≤‡∏á? ‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô?
    let statusContext = "Free Time / After School";
    if(sch) {
        for(let c of sch) {
            if(n >= toMin(c.start) && n < toMin(c.end)) {
                statusContext = `Currently studying: ${c.name} in room ${c.room}`;
                break;
            }
        }
    }
    
    const dayNames = ["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"];
    const nowStr = new Date().toLocaleTimeString("th-TH");
    
    // 3. Super Planner Prompt
    const prompt = `
    Role: You are "Hunter", an elite academic assistant for a Thai vocational student.
    User Input: "${input}"
    
    Current Situations:
    - Time: ${nowStr} (${dayNames[d]})
    - Status: ${statusContext}
    - Schedule Data: ${JSON.stringify(sch || "No Class")}
    
    Instructions:
    1. **Systematic Thinking:** Do not just answer. Break it down into steps, bullet points, or a checklist.
    2. **Planning Mode:** If asked to plan, look at the current time. 
       - If morning -> Plan the study day.
       - If evening -> Plan homework/rest.
    3. **Tone:** Concise, Professional, Smart, Encouraging (Thai Language).
    4. **Format:** Use HTML tags strictly for the output:
       - <b>Bold</b> for topics.
       - <ul><li>...</li></ul> for lists.
       - <br> for line breaks.
       - Do NOT use markdown (like ** or -).
    `;

    try {
        const response = await fetch("https://api.groq.com/openai/v1/chat/completions", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "Authorization": `Bearer ${API_KEY}`
            },
            body: JSON.stringify({
                messages: [{ role: "user", content: prompt }],
                model: MODEL,
                temperature: 0.5, // 0.5 = Balanced for planning (not too random)
                max_tokens: 1000
            })
        });

        const data = await response.json();
        const aiText = data.choices[0].message.content;
        
        // 4. Update UI & Memory
        out.innerHTML = aiText;
        localStorage.setItem("hunterMem", aiText); // ‡∏à‡∏≥‡πÑ‡∏ß‡πâ

    } catch (error) {
        out.innerHTML = `<span style="color:red">Connection Failed: ${error.message}</span>`;
    }

    btn.innerText = oldBtnText;
    btn.disabled = false;
}
</script>

</body>
</html>
